<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1.0">
		<style>
			html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
			#map {
			height: 100%;
			}
		</style>
		<title>whereis global</title>
	</head>
	<body>
		<div id="map"></div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script>
			var map;
			var iconZaq = "/zaq.gif";
			var iconBlaise = "/blaise.gif";
			var iconBlaiseAndZaq = "/blaiseandzaq.gif";
			var iconLeland = "/leland.gif";
			var marker;
			var markerBlaise;
			var markerLeland;
			function updateLocation() {
				// zaq?
				$.ajax({
				    url: "/getLocation?user=zaq",
				    type: "GET",
				    dataType : "json",
				})
				.done(function( json ) {
					myLatLng = { lat: json['latitude'], lng: json['longitude'] };
					marker.setPosition(myLatLng);
				})
				.fail(function( xhr, status, errorThrown ) {
				})
				.always(function( xhr, status ) {
				});

				// blaise
				$.ajax({
				    url: "/getLocation?user=blaise",
				    type: "GET",
				    dataType : "json",
				})
				.done(function( json ) {
					blaiseLatLng = { lat: json['latitude'], lng: json['longitude'] };
					markerBlaise.setPosition(blaiseLatLng);
					zaqBlaiseDistance = Math.sqrt(Math.pow(marker.getPosition().lat() - markerBlaise.getPosition().lat(), 2) +
							Math.pow(marker.getPosition().lng() - markerBlaise.getPosition().lng(), 2));
					if (zaqBlaiseDistance < 0.0005) {
						markerBlaise.setVisible(false);
						marker.setIcon(iconBlaiseAndZaq)
					} else {
						markerBlaise.setVisible(true);
						marker.setIcon(iconZaq)
					}
				})
				.fail(function( xhr, status, errorThrown ) {
				})
				.always(function( xhr, status ) {
				});

				// leland
				$.ajax({
				    url: "http://whereis.lelandbatey.com/api/v1/entry",
				    type: "GET",
				    dataType : "json",
				})
				.done(function( json ) {
					lelandLatLng = { lat: parseFloat(json['latitude']), lng: parseFloat(json['longitude']) };
					markerLeland.setPosition(lelandLatLng);
				})
				.fail(function( xhr, status, errorThrown ) {
				})
				.always(function( xhr, status ) {
				});

			}

			function initMap() {
				map = new google.maps.Map(document.getElementById('map'), {
					// center: <bounding box of all locations?>,
					center: {lat: 47.64096227282752, lng: -122.17883589467998},
					zoom: 11
				});
				marker = new google.maps.Marker({
					map: map,
					position: {lat: 11111, lng: 11111},
					icon: iconZaq,
					optimized: false,
					title: 'Zaq?'
				});

				markerBlaise = new google.maps.Marker({
					map: map,
					position: {lat: 11111, lng: 11111},
					icon: iconBlaise,
					optimized: false,
					title: 'Blaise'
				});

				markerLeland = new google.maps.Marker({
					map: map,
					position: {lat: 11111, lng: 11111},
					icon: iconLeland,
					optimized: false,
					title: 'Leland'
				});

				setTimeout(updateLocation, 100);
				setInterval(updateLocation, 60000);
			}
		</script>
		<!-- Everything starts on this script. Note the callback func in the url -->
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBq0Niyb0Ql8NzTMXWOkBHS7DAIW9xf56Y&callback=initMap"></script>
	</body>
</html>
